---
authors: forliy
title: 2022å¹´ç¬¬40å‘¨å‘¨æŠ¥
tags: [2022å‘¨æŠ¥,å‘¨æŠ¥]
---


å¤§æ¦‚æ˜¯2022å¹´ç¬¬40å‘¨å‘¨æŠ¥å–µã€‚

<!--truncate-->


import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<div style={{textAlign: 'center'}}>
<small><i>æ—¶é—´å¦‚å­©ç«¥, å¬‰ç¬‘å¸‚äº•é—´; æ—¶é—´è‹¥å·æµ, æ¶“æ¶“çŸ³ç½…éš™.</i></small>
</div>

## ğŸš€ æ ¸å¿ƒåº“æ›´æ–°

æœ¬å‘¨ [æ ¸å¿ƒåº“](https://github.com/simple-robot/simpler-robot) æš‚æ—¶æ²¡æœ‰æ–°çš„ç‰ˆæœ¬æ›´æ–°ï¼Œä¸è¿‡å·²ç»æœ‰äº†å‡ ä¸ªé¢„å¤‡ç‰¹æ€§å°†ä¼šåœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­å‘ˆç°ï¼š
- `EventResult` ç»“æ„ä¼˜åŒ–; å“åº”å€¼æ”¯æŒå¤„ç† `CompletableFuture` ä¸ `Deferred` ([#466](https://github.com/simple-robot/simpler-robot/pull/466))
- è°ƒæ•´ç›‘å¬å‡½æ•°çš„æ³¨å†Œã€è°ƒåº¦æœºåˆ¶; å¼ƒç”¨ `EventListener` ä¸­çš„`id`ã€`priority`ã€`isAsync`å±æ€§å¹¶å°†è¿™äº›ä¿¡æ¯è°ƒæ•´åˆ°æ³¨å†Œæ—¶ ([#465](https://github.com/simple-robot/simpler-robot/pull/465))
- å®Œå–„ `DelayableCompletableFuture` å†…å®¹ ([#463](https://github.com/simple-robot/simpler-robot/pull/463))

è®©æˆ‘ä»¬ç®€å•èŠèŠè¿™å‡ ä¸ªç‰¹æ€§.

### å®Œå–„ `DelayableCompletableFuture` å†…å®¹ ([#463](https://github.com/simple-robot/simpler-robot/pull/463))

åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­, `DelayableCompletableFuture` ä¸ `CompletableFuture` ä¹‹é—´å…¶å®æ˜¯ç›¸äº’ç‹¬ç«‹çš„, è€Œåœ¨ #463 çš„ä¼˜åŒ–ä¹‹å, å®ƒä»¬ä¹‹é—´ä¾¿æœ‰äº†æ›´å¤šçš„å…±é€šæ€§.

### è°ƒæ•´ç›‘å¬å‡½æ•°çš„æ³¨å†Œã€è°ƒåº¦æœºåˆ¶; å¼ƒç”¨ `EventListener` ä¸­çš„`id`ã€`priority`ã€`isAsync`å±æ€§å¹¶å°†è¿™äº›ä¿¡æ¯è°ƒæ•´åˆ°æ³¨å†Œæ—¶ ([#465](https://github.com/simple-robot/simpler-robot/pull/465))

æˆ‘ä»¬åœ¨å¾ˆä¹…ä¹‹å‰ä¾¿æ³¨æ„åˆ°ï¼Œç»å¸¸æœ‰äººä¼šæ¯”è¾ƒå…³å¿ƒæˆ–è€…æœŸæœ›èƒ½å¤Ÿæ‹¥æœ‰ä¸€ä¸ª**åŠ¨æ€æ³¨å†Œç›‘å¬å‡½æ•°**çš„ç‰¹æ€§ä¸èƒ½åŠ›ã€‚
åœ¨è¿™ä¹‹å‰ï¼Œsimbotæ ¸å¿ƒä¸­æä¾›çš„äº‹ä»¶è°ƒåº¦å™¨æ¨èé¢„æ³¨å†Œç›‘å¬å‡½æ•°ï¼Œæ”¯æŒåç»­æ³¨å†Œè€Œä¸æ”¯æŒ**å‡½æ•°ç§»é™¤**ã€‚

åŸæœ¬çš„è°ƒåº¦å™¨ä¸­ï¼Œä¼šå¯¹æ‰€æœ‰çš„ç›‘å¬å‡½æ•°è¿›è¡Œé¢„å¤„ç†ä¸ç¼“å­˜ï¼Œå¦‚æœé¢‘ç¹çš„åŠ¨æ€å¢åˆ ç›‘å¬å‡½æ•°ä¼šå¤§å¤§é™ä½æ•´ä½“æ•ˆç‡ã€‚
è€Œè¿™æ¬¡åœ¨ [#465](https://github.com/simple-robot/simpler-robot/pull/465) ä¸­ï¼Œ
æˆ‘ä»¬å¯¹å…¶å†…éƒ¨çš„æ•´ä½“ç»“æ„åšäº†è°ƒæ•´ï¼Œåœ¨ä¿ç•™äº†åŸæœ‰å¤§éƒ¨åˆ†ç‰¹æ€§çš„æƒ…å†µä¸‹ï¼Œæ”¯æŒçš„ç›‘å¬å‡½æ•°çš„åŠ¨æ€æ³¨å†Œä¸åˆ é™¤ã€‚

<Tabs>
<TabItem value='applicationæ„å»ºè¿‡ç¨‹ä¸­'>

```kotlin
createSimpleApplication {
    listeners {
        FriendEvent { // this: EventListenerProcessingContext
            // å½“å‰æ‰€å¤„çš„ç›‘å¬å‡½æ•°çš„å¥æŸ„.
            val currentHandle = this.listenerHandle

            // å¾—åˆ°å½“å‰ç›‘å¬å‡½æ•°æ‰€å±çš„å®¹å™¨
            val currentContainer = currentHandle.container
            // åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ–°çš„ç›‘å¬å‡½æ•°, å¹¶å¾—åˆ°è¿™ä¸ªæ–°å‡½æ•°çš„å¥æŸ„
            val newListenerHandle = currentContainer.register(buildSimpleListener(FriendMessageEvent) {
            match { /* ... */ true }
            process { /* å¤„ç†äº‹ä»¶ */ }
        })

        // ç­‰å¾…0.5s
        delay(500)

        // åˆ é™¤è¿™ä¸ªç›‘å¬å‡½æ•°.
        newListenerHandle.dispose()

        // åˆ é™¤è‡ªå·±(å½“å‰çš„ç›‘å¬å‡½æ•°)
        currentHandle.dispose()
        }
    }
}
```

</TabItem>
<TabItem value='applicationæ„å»ºå®Œæˆå'>

```kotlin
val application = createSimpleApplication {
    // ...
}
// å¾—åˆ°äº‹ä»¶ç®¡ç†å™¨
val manager = application.eventListenerManager
repeat(500) {
    // æ³¨å†Œä¸€ä¸ªç›‘å¬å‡½æ•°
    val handle = manager.register(buildSimpleListener(FriendEvent) {
        match { /* ... */ true }
        process { /* ... */ }
    })

    // å»¶è¿Ÿä¸€æ®µæ—¶é—´ååˆ æ‰å®ƒ
    delay(Random.nextLong(500))
    handle.dispose()
}
```

</TabItem>
</Tabs>

å›åˆ°æ ‡é¢˜ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°äº† `EventListener` ä¸­çš„å¤§éƒ¨åˆ†å±æ€§å¯¹äºå…¶æœ¬èº«æ¥è®²å¹¶ä¸å¿…è¦ï¼Œå¯¹äºä¸€ä¸ª**å‡½æ•°**æ¥è®²ï¼Œä»–ä¸åº”å…³å¿ƒè‡ªå·±æ˜¯ä¸æ˜¯**å”¯ä¸€(id)**ï¼Œ
ä¸åº”å…³å¿ƒè‡ªå·±çš„**ä¼˜å…ˆçº§(priority)**ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒè‡ªå·±æ˜¯ä¸æ˜¯æ‹¥æœ‰ä¸€ä¸ª**å¼‚æ­¥æ ‡è¯†(isAsync)**(ç”šè‡³å¯ä»¥åœ¨é€»è¾‘ä¸­è‡ªè¡Œå®ç°å¼‚æ­¥è¡Œä¸º)ã€‚
å› æ­¤ï¼Œæˆ‘ä»¬å¼ƒç”¨äº† `EventListener` ä¸­è¿™äº›æ²¡æœ‰å¿…è¦çš„å±æ€§ï¼Œå¹¶å°†è¿™äº›å±æ€§æ•´åˆåˆ°äº†**æ³¨å†Œæ—¶**æ‰éœ€è¦æä¾›ï¼š

```kotlin
val application = createSimpleApplication {
}
// å¾—åˆ°äº‹ä»¶ç®¡ç†å™¨
val manager = application.eventListenerManager
// æ„å»ºä¸€ä¸ªç›‘å¬å‡½æ•°
val listener = buildSimpleListener(FriendEvent) {
    match { /* ... */ true }
    process { /* ... */ }
}
// å…è®¸é‡å¤æ³¨å†Œ
manager.register(listener)
manager.register(listener)
// æä¾›æ›´å¤š'å±æ€§'
manager.register(listener.toRegistrationDescription {
    priority = PriorityConstant.FIRST
    isAsync = true
})
manager.register(listener.toRegistrationDescription {
    priority = PriorityConstant.LAST
    isAsync = false
})
```

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–°çš„ç±»å‹ `EventListernerRegistrationDescription` æ¥æ‰¿è½½è¿™äº› `EventListener` è‡ªèº«ä¸éœ€è¦å…³å¿ƒçš„å±æ€§ã€‚

:::tip 465

æ›´å¤šè¯¦æƒ…å‚è€ƒ [#465](https://github.com/simple-robot/simpler-robot/pull/465)

:::

### `EventResult` ç»“æ„ä¼˜åŒ–; å“åº”å€¼æ”¯æŒå¤„ç† `CompletableFuture` ä¸ `Deferred` ([#466](https://github.com/simple-robot/simpler-robot/pull/466))

ä¹Ÿè®¸ä½ å¯èƒ½æœ‰æ³¨æ„åˆ°è¿‡ï¼Œ`EventResult.content` åœ¨é»˜è®¤æƒ…å†µä¸‹æ”¯æŒå°†éé˜»å¡çš„å“åº”å¼ç»“æœè¿›è¡Œè‡ªåŠ¨æ”¶é›†ï¼ˆä¾‹å¦‚ `reactor` æˆ– `rxJava`ï¼‰ï¼Œè¿™ä¸€ç‰¹æ€§ä¹Ÿåœ¨ `EventResult.content` çš„æ–‡æ¡£è¯´æ˜ä¸Šæœ‰æ‰€ä½“ç°ã€‚

è€Œ [#466](https://github.com/simple-robot/simpler-robot/pull/466) åœ¨è¿™ä¹‹å‰æ”¯æŒçš„åŸºç¡€ä¸Šï¼Œåˆå¢åŠ æ”¯æŒäº†å¯¹ `CompletableFuture` ä¸ `Deferred`
è¿™ä¸¤ä¸ªå¼‚æ­¥ç±»å‹çš„æ”¶é›†ï¼ŒåŒæ—¶å®Œå–„äº† `EventResult` æ•´ä½“çš„ä¾èµ–å…³ç³»ï¼Œä½¿å®ƒä»¬å„è‡ªçš„èŒè´£æ›´åŠ æ¸…æ™°ã€‚

:::tip 466

æ›´å¤šè¯¦æƒ…å‚è€ƒ [#466](https://github.com/simple-robot/simpler-robot/pull/466)

:::
